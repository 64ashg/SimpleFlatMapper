language: java

sudo: required
dist: trusty

services:
  - postgresql

addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6

jdk:
  - oraclejdk9
  - oraclejdk8
  - openjdk7
  - openjdk6

matrix:
  include:
    - jdk: oraclejdk8
    - jdk: oraclejdk9
      install: . ./.travis/install-jdk-9.sh
    - jdk: openjdk7
      install: . ./.travis/install-jdk-7.sh
    - jdk: openjdk6
      install: . ./.travis/install-jdk-6.sh
    

script: java -version 2>&1 | grep 'version "9"' ; if [ $? -eq 0 ]; then echo java 9 $?; mvn test -B; else echo java lt 9 $?; mvn test javadoc:javadoc -B; fi


env:
  - MAVEN_SKIP_RC=true TRAVISBUILD=true

after_success:
  - mvn -P travis,!dev -DserviceName=travis-ci jacoco:report coveralls:report


before_install:
  - echo "127.0.0.1    $HOSTNAME" | sudo tee -a /etc/hosts
  - wget https://archive.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.zip
  - unzip -qq apache-maven-3.2.5-bin.zip
  - export M2_HOME=$PWD/apache-maven-3.2.5
  - export PATH=$M2_HOME/bin:$PATH

  
before_script:
  - mysql --verbose -u root -e 'create database sfm;'
  - mysql --verbose -u root -e "CREATE USER 'sfm'@'localhost';"
  - mysql --verbose -u root -e "GRANT ALL ON sfm.* TO 'sfm'@'localhost';"
  - psql -c 'create database sfm;' -U postgres
